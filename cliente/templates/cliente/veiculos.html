{% extends 'cliente/base_clientes.html' %}
{% load static %}

{% block content %}
    <div class="vehicle_type_veiculos">
        <h2 id="title">Incluir novo veículo</h2>
        <div class="vehicle_type">
            <h2>Tipo de Veículo:</h2>
            <button class='btn-vehicle-type btn-active' id='btn-type-car' onclick="btnActive(btnCar, btnMoto, btnOther, 'C')"><img src="{% static 'imagens/img_carro_az.png' %}" alt="Carro Azul" id="car">Carro</button>
            <button class='btn-vehicle-type' id='btn-type-moto' onclick="btnActive(btnMoto, btnCar, btnOther, 'M')"><img src="{% static 'imagens/img_moto_az.png' %}" alt="Moto Azul" id="moto">Moto</button>
            <button class='btn-vehicle-type' id='btn-type-other' onclick="btnActive(btnOther, btnCar, btnMoto, 'O')"><img src="{% static 'imagens/img_demais_az.png' %}" alt="Caminhão Azul" id="others_vehicles">Demais Veículos</button>
        </div>
        <form class="veiculos_form" id="novo_veiculo_form">
            {% csrf_token %}
            <div class="add_plate">
                <h2>Placa:</h2>
                <input type="text" placeholder="Insira a Placa" id="placa" maxlength="7" autocapitalize="characters" onfocus="innerBoxShadow()" onblur="removeInnerBox()">
                <button type="submit"><img src="{% static 'imagens/add_plate.png' %}" alt="Adicionar Carro">Adicionar</button>
            </div>  
        </form>
    </div>
        
    <div class="cliente_messages msg-success" style="display:none;" id="msg-teste">
        <p>Carro Cadastrado com Sucesso!</p><button type="button" class="btn-close" onclick="deletarMensagem(this)">&times;</button>
    </div>

    <div class="vehicle_plate_veiculos">
        <h2 class="vehicle_plate_title">Veículos:</h2>
            <div class="vehicle_plate_plates">
                {% for car in cars %}
                    <div class="plate_button">
                        <button class="btn_vehicle_plate"><img src="{% static 'imagens/img_carro_az.png' %}" alt="Carro Azul" id="car">{{car}}</button>
                        <div class="button_remove">
                            <a href="{% url 'excluirVeiculo' user.client.id car.id %}"><img src="{% static 'imagens/remove_car.png' %}" alt="stylesheet"></a>
                        </div>
                    </div>
                {% endfor %}
                {% for moto in motos %}
                    <div class="plate_button">
                        <button class="btn_vehicle_plate"><img src="{% static 'imagens/img_moto_az.png' %}" alt="Carro Azul" id="car">{{moto}}</button>
                        <div class="button_remove">
                            <a href="{% url 'excluirVeiculo' user.client.id moto.id %}"><img src="{% static 'imagens/remove_car.png' %}" alt="stylesheet"></a>
                        </div>
                    </div>
                {% endfor %}
                {% for other in others %}
                    <div class="plate_button">
                        <button class="btn_vehicle_plate"><img src="{% static 'imagens/img_demais_az.png' %}" alt="Carro Azul" id="car">{{other}}</button>
                        <div class="button_remove">
                            <a href="{% url 'excluirVeiculo' user.client.id other.id %}"><img src="{% static 'imagens/remove_car.png' %}" alt="stylesheet"></a>
                        </div>
                    </div>
                {% endfor %}
            </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
        let pageTitle = document.getElementById('page-title')
        pageTitle.innerHTML = 'Meus Veículos'

        let divMensagem = document.getElementById('div-message')

        function deletarMensagem(botao) {
            botao.parentElement.remove()
        }

        let vehicle_type = 'C'
        let btnCar = document.getElementById('btn-type-car')
        let btnMoto = document.getElementById('btn-type-moto')
        let btnOther = document.getElementById('btn-type-other')
        let placa = document.getElementById('placa')

        
        function innerBoxShadow() {
            placa.classList.add('inner-box-shadow')
        }


        function removeInnerBox() {
            placa.classList.remove('inner-box-shadow')
        }


        function btnActive(botao1, botao2, botao3, tipo) {
            botao2.classList.remove('btn-active')
            botao3.classList.remove('btn-active')
            botao1.classList.add('btn-active')
            vehicle_type = tipo
        }


        $(document).on('submit', '#novo_veiculo_form', function(){

            $.ajax({
                type: 'POST',
                url: '',
                data: {
                    license_plate: $('#placa').val().toUpperCase(),
                    vehicle_type: vehicle_type,
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
                success:function(){
                    $("#msg-teste").load();
                }
            });

        });

    </script>
{% endblock %}